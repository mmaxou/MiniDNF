import{_ as T,r,o as G,b as B,g as f,a as k,c as p,d as R,e as i,f as e,t as c,h as M,F as J,i as z,w as H,j as _,k as V,v as K,l as P,s as Q,p as W,m as X,n as Y,u as Z,q as u}from"./index-Cayjcd81.js";const ee={class:"container mt-4"},te={class:"d-flex justify-content-between align-items-center mb-4"},se={class:"badge text-bg-info fs-6"},ae={class:"row"},oe={class:"card h-100 character-card"},le={class:"card-body"},re={class:"card-title"},ne={class:"d-flex gap-2 mb-3"},de={class:"badge text-bg-primary"},ie={class:"badge text-bg-secondary"},ce={class:"d-flex gap-2"},ue=["onClick"],be=["onClick"],me={class:"modal fade",id:"createCharacterModal",tabindex:"-1","aria-labelledby":"createCharacterModalLabel","aria-hidden":"true"},ve={class:"modal-dialog"},he={class:"modal-content"},fe={class:"modal-body"},pe={class:"mb-3"},_e={class:"mb-3"},ye={key:0,class:"alert alert-danger",role:"alert"},ge={class:"modal-footer"},Ce=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},we={class:"modal fade",id:"characterDetailModal",tabindex:"-1","aria-labelledby":"characterDetailModalLabel","aria-hidden":"true"},ke={class:"modal-dialog"},Me={class:"modal-content"},Le={key:0,class:"modal-body"},$e={class:"modal-footer"},De=["disabled"],Ie={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Ne={__name:"CharacterList",setup(Ue){const L=r([]),b=r(""),y=r(""),m=r(null),n=r(!1),$=r(""),j=Z(),g=r(null),D=r(null);G(()=>{var t;g.value=new B.Modal(document.getElementById("createCharacterModal")),D.value=new B.Modal(document.getElementById("characterDetailModal")),C();const a=f();$.value=((t=a.currentUser)==null?void 0:t.email)||"未知用户"});const I=a=>{j.push({name:"game",query:{character:JSON.stringify(a)}})},C=async()=>{var d;const t=(d=f().currentUser)==null?void 0:d.uid;if(!t)return;const s=k(),o=p(s,`users/${t}/characters`);try{const l=await R(o);if(l.exists()){const h=l.val();L.value=Object.entries(h).map(([x,w])=>({id:x,...w}))}}catch(l){console.error("加载角色列表失败:",l)}},q=()=>{b.value="",g.value.show()},v=r(""),N=async()=>{var s;if(!b.value.trim())return;v.value="",n.value=!0;const t=(s=f().currentUser)==null?void 0:s.uid;try{const o=k(),d=p(o,"users"),l=await R(d);let h=!1;if(l.exists()){const E=l.val();for(const A in E){const S=E[A].characters||{};for(const F in S)if(S[F].name===b.value){h=!0;break}if(h)break}}if(h){v.value="该角色名称已被使用，请选择其他名称";return}const x=p(o,`users/${t}/characters`),w=W(x);await X(w,{name:b.value,class:y.value,level:1,createdAt:new Date().toISOString()}),g.value.hide(),await C()}catch(o){console.error("创建角色失败:",o),v.value="创建角色失败，请稍后重试"}finally{n.value=!1}},U=async a=>{var o,d;if(!a||!confirm(`确定要删除角色「${a.name}」吗？
此操作不可恢复。`))return;n.value=!0;const s=(o=f().currentUser)==null?void 0:o.uid;try{const l=k();await Y(p(l,`users/${s}/characters/${a.id}`)),(d=D.value)==null||d.hide(),await C()}catch(l){console.error("删除角色失败:",l)}finally{n.value=!1}},O=async()=>{const a=f();try{await Q(a),console.log("退出登录成功")}catch(t){console.error("退出登录失败:",t)}};return(a,t)=>(u(),i("div",ee,[e("div",te,[e("span",se,"当前账号："+c($.value),1),e("button",{class:"btn btn-outline-danger",onClick:O},t[4]||(t[4]=[e("i",{class:"bi bi-box-arrow-right me-2"},null,-1),M("退出登录 ")]))]),t[14]||(t[14]=e("h2",{class:"text-center mb-4"},"角色管理",-1)),e("div",ae,[(u(!0),i(J,null,z(L.value,s=>(u(),i("div",{key:s.id,class:"col-md-4 mb-4"},[e("div",oe,[e("div",le,[e("h5",re,c(s.name),1),e("div",ne,[e("span",de,"Lv"+c(s.level),1),e("span",ie,c(s.class),1)]),e("div",ce,[e("button",{class:"btn btn-sm btn-primary",onClick:o=>I(s)},"开始游戏",8,ue),e("button",{class:"btn btn-sm btn-danger",onClick:o=>U(s)},"删除角色",8,be)])])])]))),128)),e("div",{class:"col-md-4 mb-4"},[e("div",{class:"card h-100 create-character-card",onClick:q},t[5]||(t[5]=[e("div",{class:"card-body d-flex align-items-center justify-content-center"},[e("div",{class:"text-center"},[e("i",{class:"bi bi-plus-circle fs-1"}),e("h5",{class:"mt-2"},"创建新角色")])],-1)]))])]),e("div",me,[e("div",ve,[e("div",he,[t[11]||(t[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createCharacterModalLabel"},"创建新角色"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",fe,[e("form",{onSubmit:H(N,["prevent"])},[e("div",pe,[t[6]||(t[6]=e("label",{for:"characterName",class:"form-label"},"角色名称",-1)),V(e("input",{type:"text",class:"form-control",id:"characterName","onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),required:""},null,512),[[K,b.value]])]),e("div",_e,[t[8]||(t[8]=e("label",{for:"characterClass",class:"form-label"},"职业",-1)),V(e("select",{class:"form-select",id:"characterClass","onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),required:""},t[7]||(t[7]=[e("option",{value:""},"请选择职业",-1),e("option",{value:"鬼剑士"},"鬼剑士",-1),e("option",{value:"神枪手"},"神枪手",-1),e("option",{value:"格斗家"},"格斗家",-1)]),512),[[P,y.value]])]),v.value?(u(),i("div",ye,c(v.value),1)):_("",!0)],32)]),e("div",ge,[t[10]||(t[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:N,disabled:n.value},[n.value?(u(),i("span",xe)):_("",!0),t[9]||(t[9]=M(" 创建 "))],8,Ce)])])])]),e("div",we,[e("div",ke,[e("div",Me,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"characterDetailModalLabel"},"角色详情"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),m.value?(u(),i("div",Le,[e("h4",null,c(m.value.name),1),e("p",null,"等级: "+c(m.value.level),1)])):_("",!0),e("div",$e,[e("button",{type:"button",class:"btn btn-danger",onClick:t[2]||(t[2]=s=>U(m.value)),disabled:n.value},[n.value?(u(),i("span",Ie)):_("",!0),t[12]||(t[12]=M(" 删除角色 "))],8,De),e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=s=>I(m.value))}," 开始游戏 ")])])])])]))}},Se=T(Ne,[["__scopeId","data-v-cc882d10"]]);export{Se as default};
